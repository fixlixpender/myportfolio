<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Filipe Oliveira | The Developer's Deck</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="laptop.png">

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Russo+One&family=Share+Tech+Mono&display=swap" rel="stylesheet">

    <!-- Three.js (Background Animation) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <!-- Your Custom Background Script -->
    <script src="background.js"></script>

    <!-- Configuration -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cyber: {
                            black: "#050505",
                            dark: "#0a0a0a",
                            blue: "#00f0ff",
                            pink: "#ff00ff",
                            green: "#00ff41",
                        },
                    },
                    fontFamily: {
                        mono: ['"Share Tech Mono"', 'monospace'],
                        russo: ['"Russo One"', 'sans-serif'],
                    },
                    backgroundImage: {
                        'grid-pattern': "linear-gradient(to right, #111 1px, transparent 1px), linear-gradient(to bottom, #111 1px, transparent 1px)",
                    }
                }
            }
        }
    </script>

    <!-- Styles -->
    <style>
        body {
            background-color: #050505;
            color: #e0e0e0;
            overflow-x: hidden;
            font-family: "Share Tech Mono", monospace;
        }

        /* RGB Text Glitch */
        .glitch-wrapper { position: relative; color: white; z-index: 1; }
        .glitch-wrapper::before, .glitch-wrapper::after {
            content: attr(data-text); position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.8;
        }
        .glitch-wrapper::before { z-index: -1; color: #ff00ff; animation: glitch-anim-1 2.5s infinite linear alternate-reverse; }
        .glitch-wrapper::after { z-index: -2; color: #00f0ff; animation: glitch-anim-2 3s infinite linear alternate-reverse; }
        
        @keyframes glitch-anim-1 {
            0% { clip-path: inset(20% 0 80% 0); transform: translate(-2px, 1px); }
            100% { clip-path: inset(30% 0 50% 0); transform: translate(1px, -1px); }
        }
        @keyframes glitch-anim-2 {
            0% { clip-path: inset(10% 0 60% 0); transform: translate(2px, -1px); }
            100% { clip-path: inset(70% 0 10% 0); transform: translate(-2px, -1px); }
        }

        /* SPA Transitions */
        .section-container { transition: opacity 0.5s ease, transform 0.5s ease; width: 100%; }
        .hidden-section { display: none; opacity: 0; pointer-events: none; }
        .active-section { display: block; opacity: 1; pointer-events: all; animation: bootSection 0.6s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes bootSection { 0% { opacity: 0; transform: translateY(20px); } 100% { opacity: 1; transform: translateY(0); } }
        
        /* Thumbnails */
        .thumb-active { border-color: #00ff41 !important; box-shadow: 0 0 8px #00ff41; }
        
        /* Utils */
        .hidden-force { display: none !important; }
    </style>
</head>
<body class="bg-cyber-black min-h-screen pb-24 relative selection:bg-cyber-pink selection:text-black">

    <!-- FX LAYERS -->
    <div id="canvas-container" class="fixed inset-0 z-[-1] pointer-events-none"></div>

    <!-- AUDIO SYSTEM -->
    <audio id="bg-music" loop><source src="factions.mp3" type="audio/mpeg"></audio>
    <audio id="sfx-type" src="sfx-type.mp3"></audio>
    <audio id="sfx-enter" src="sfx-enter.mp3"></audio>
    <audio id="sfx-hover" src="sfx-hover.mp3"></audio>
    <audio id="sfx-boot" src="sfx-boot.mp3"></audio>

    <!-- 1. START OVERLAY (Click to Initialize) -->
    <div id="start-overlay" class="fixed inset-0 bg-cyber-black z-[200] flex items-center justify-center cursor-pointer">
        <div class="text-center">
            <div class="text-cyber-green text-2xl md:text-4xl font-mono tracking-widest animate-pulse border-b-2 border-cyber-green pb-2">
                >> INITIALIZE SYSTEM <<
            </div>
            <p class="text-cyber-blue mt-4 text-xs md:text-sm font-mono opacity-70">[ CLICK ANYWHERE TO BOOT ]</p>
        </div>
    </div>

    <!-- 2. BOOT LOGS SCREEN (Black screen with text) -->
    <div id="boot-screen" class="fixed inset-0 bg-cyber-black z-[150] hidden flex-col justify-end p-8 text-cyber-green font-mono">
        <div class="max-w-2xl w-full mx-auto" id="log-container"></div>
    </div>

    <!-- ================================================================= -->
    <!-- SECTION: HOME DASHBOARD (ID: home-section)                        -->
    <!-- ================================================================= -->
    <section id="home-section" class="hidden-section section-container px-6 pb-6 pt-24 md:p-12 max-w-[1600px] mx-auto z-10 relative">
        
        <!-- HEADER -->
        <!-- Added 'relative z-[60]' to force it above the scanlines -->
        <header class="mb-12 border-b border-cyber-green/30 pb-6 flex justify-between items-end relative z-[60]">
            <div>
                <h2 class="text-cyber-green text-sm mb-2 tracking-widest">SYSTEM: <span class="animate-pulse">ONLINE</span></h2>
                <h1 class="text-3xl md:text-6xl font-russo text-white cursor-default glitch-wrapper" data-text="THE DEVELOPER'S DECK">THE DEVELOPER'S DECK</h1>
                <p class="mt-2 text-cyber-pink max-w-lg font-mono">FILIPE OLIVEIRA // FULL-STACK OPERATIVE</p>
            </div>
            <div class="flex flex-col items-end gap-2">
            <!-- New Help Button -->
            <button onclick="processCommand('HELP')" class="border border-cyber-blue text-cyber-blue px-3 py-1 text-xs hover:bg-cyber-blue hover:text-black transition-colors uppercase font-mono">
                [ CMD_LIST ]
            </button>
            
            <!-- Existing Music Button -->
            <button id="music-btn" class="border border-cyber-green text-cyber-green px-3 py-1 text-xs hover:bg-cyber-green hover:text-black transition-colors uppercase font-mono">
                [ MUSIC: OFF ]
            </button>
        </div>
        </header>

        <!-- DASHBOARD GRID -->
        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <!-- NAV -->
            <nav class="lg:col-span-1 flex flex-col gap-4">
                <button onclick="navigateTo('projects-section')" class="bg-transparent border border-gray-800 p-6 text-center transition-all duration-300 neon-box-blue group hover:bg-cyber-blue/10">
                    <span class="font-bold text-lg group-hover:text-cyber-blue font-mono">PROJECTS [LS]</span>
                </button>
                <button onclick="navigateTo('about-section')" class="bg-transparent border border-gray-800 p-6 text-center transition-all duration-300 neon-box-green group hover:bg-cyber-green/10">
                    <span class="font-bold text-lg group-hover:text-cyber-green font-mono">IDENTITY [WHOAMI]</span>
                </button>
                <button onclick="navigateTo('recruit-section')" class="bg-transparent border border-gray-800 p-6 text-center transition-all duration-300 neon-box-pink group hover:bg-cyber-pink/10">
                    <span class="font-bold text-lg group-hover:text-cyber-pink font-mono">RECRUIT [RECRUIT]</span>
                </button>
                <div class="mt-auto p-4 border border-cyber-green/20 bg-transparent">
                    <h3 class="text-cyber-green text-xs mb-2 font-mono">SKILL_TREE</h3>
                    <div class="flex flex-wrap gap-2 text-xs text-gray-400 font-mono"><span>JavaScript</span>/<span>HTML5</span>/<span>Tailwind</span>/<span>Three.js</span></div>
                </div>
            </nav>
            <!-- FEED -->
            <section class="lg:col-span-2 flex flex-col gap-6">
                <div class="bg-cyber-dark/80 border border-cyber-green/30 p-6 relative overflow-hidden group hover:border-cyber-green transition-colors duration-300">
                    <div class="absolute top-0 left-0 w-1 h-full bg-cyber-green/50 group-hover:h-full transition-all duration-500"></div>
                    <h3 class="text-xl text-cyber-blue mb-2 font-mono">LATEST_DEPLOYMENT</h3>
                    <p class="text-gray-300 mb-4 font-mono">Project "Kinetic Core" deployed. An interactive AI particle interface.</p>
                    <!-- NAV GYRO CONTAINER -->
                    <div class="bg-cyber-dark/80 border border-cyber-pink/30 relative overflow-hidden group h-64 flex flex-col">
                        <!-- Header -->
                        <div class="absolute top-0 left-0 w-full p-2 z-10 flex justify-between pointer-events-none">
                            <h3 class="text-xs text-cyber-pink font-mono tracking-widest bg-black/50 px-2">NAV_GYRO_SYSTEM</h3>
                            <div class="text-[10px] text-cyber-blue font-mono">
                                PITCH: <span id="gyro-x">0</span> // YAW: <span id="gyro-y">0</span>
                            </div>
                        </div>
                        
                        <!-- Crosshair Overlay -->
                        <div class="absolute inset-0 z-0 pointer-events-none flex items-center justify-center opacity-30">
                            <div class="w-64 h-[1px] bg-cyber-pink/50"></div>
                            <div class="h-32 w-[1px] bg-cyber-pink/50 absolute"></div>
                            <div class="w-16 h-16 border border-cyber-pink/50 rounded-full absolute"></div>
                            <!-- Interactive Hint -->
                            <div class="absolute bottom-2 right-2 z-20 pointer-events-none">
                                <span class="text-[10px] text-cyber-pink/70 bg-black/50 px-1 font-mono blink">
                                    [CLICK TO ENHANCE / ZOOM]
                                </span>
                            </div>
                        </div>

                        <!-- The 3D Canvas lives here -->
                        <div id="mini-map-container" class="w-full h-full cursor-crosshair"></div>
                    </div>
                </div>
            </section>
            <!-- STATUS -->
            <aside class="lg:col-span-1 flex flex-col gap-4">
                <div class="border border-cyber-blue/30 p-4 bg-cyber-black">
                    <h4 class="text-cyber-blue text-xs border-b border-cyber-blue/20 pb-2 mb-2 font-mono">SYSTEM_STATUS</h4>
                    <div class="space-y-2">
                        <div class="flex items-center gap-2"><div class="w-2 h-2 bg-cyber-green rounded-full animate-pulse"></div><span class="text-xs text-gray-300 font-mono">SERVER: OPTIMAL</span></div>
                        <div class="w-full bg-gray-800 h-1 mt-2"><div class="bg-cyber-blue h-full" style="width: 87%"></div></div>
                        <div class="text-right text-[10px] text-cyber-blue font-mono">MEMORY_LOAD: 87%</div>
                    </div>
                </div>
            </aside>
        </div>
    </section>

    <!-- ================================================================= -->
    <!-- SECTION: PROJECTS DIRECTORY (ID: projects-section)                -->
    <!-- ================================================================= -->
    <section id="projects-section" class="hidden-section section-container max-w-[90vw] mx-auto p-4 md:p-8 space-y-24 z-10 relative">
        <header class="sticky top-0 z-40 bg-cyber-black/95 backdrop-blur-md border-b border-cyber-green/30 p-4 mb-8 flex justify-between items-center">
            <span class="text-cyber-green text-xl font-bold blink font-mono">>> DIRECTORY_LISTING</span>
            <button onclick="navigateTo('home-section')" class="px-4 py-2 border border-cyber-blue text-cyber-blue hover:bg-cyber-blue hover:text-black transition-colors text-sm uppercase font-mono">[ < BACK TO ROOT ]</button>
        </header>

        <!-- PROJECT 1 -->
        <article class="bg-transparent border border-cyber-green/30 p-1 md:p-6 relative group">
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-4">
                    <div id="p1-viewer" class="aspect-video bg-black border border-cyber-green/50 relative overflow-hidden flex items-center justify-center">
                        <video class="w-full h-full object-cover" autoplay loop muted playsinline><source src="demo.mp4" type="video/mp4"></video>
                    </div>
                    <div class="flex gap-3 overflow-x-auto pb-2">
                        <button onclick="switchMedia('p1', 'video', 'demo.mp4')" class="w-20 h-12 border border-cyber-green/30 hover:border-cyber-green thumb-active shrink-0 bg-gray-900 flex items-center justify-center"><span class="text-[10px] text-cyber-green font-mono">VIDEO</span></button>
                        <button onclick="switchMedia('p1', 'image', 'room1.PNG')" class="w-20 h-12 border border-cyber-green/30 hover:border-cyber-green shrink-0"><img src="room1.PNG" class="w-full h-full object-cover opacity-70 hover:opacity-100"></button>
                    </div>
                </div>
                <div class="flex flex-col h-full font-mono">
                    <h2 class="text-3xl md:text-4xl text-white font-bold mb-2 glitch-text">MY_JAVA_ROOM</h2>
                    <p class="text-gray-400 text-sm mb-6 border-l-2 border-cyber-green/20 pl-4">An interactive 3D environment built with Three.js.</p>
                </div>
            </div>
        </article>

        <!-- PROJECT 2 -->
        <article class="bg-transparent border border-cyber-pink/30 p-1 md:p-6 relative group">
             <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="flex flex-col h-full order-2 lg:order-1 font-mono">
                    <h2 class="text-3xl md:text-4xl text-white font-bold mb-2">TOUCHLESS WEBSITE</h2>
                    <p class="text-gray-400 text-sm mb-6 border-l-2 border-cyber-pink/20 pl-4">Controlled entirely with hand gestures via webcam.</p>
                </div>
                <div class="space-y-4 order-1 lg:order-2">
                    <div id="p2-viewer" class="aspect-video bg-black border border-cyber-pink/50 relative overflow-hidden flex items-center justify-center">
                        <video class="w-full h-full object-contain" autoplay loop muted playsinline><source src="websitevid.mp4" type="video/mp4"></video>
                    </div>
                     <div class="flex gap-3 overflow-x-auto pb-2">
                        <button onclick="switchMedia('p2', 'video', 'websitevid.mp4')" class="w-20 h-12 border border-cyber-pink/30 hover:border-cyber-pink thumb-active shrink-0 bg-gray-900 flex items-center justify-center"><span class="text-[10px] text-cyber-pink font-mono">VIDEO</span></button>
                        <button onclick="switchMedia('p2', 'image', 'website1.png')" class="w-20 h-12 border border-cyber-pink/30 hover:border-cyber-pink shrink-0"><img src="website1.png" class="w-full h-full object-cover opacity-70 hover:opacity-100"></button>
                        <button onclick="switchMedia('p2', 'image', 'website2.png')" class="w-20 h-12 border border-cyber-pink/30 hover:border-cyber-pink shrink-0"><img src="website2.png" class="w-full h-full object-cover opacity-70 hover:opacity-100"></button>
                     </div>
                </div>
            </div>
        </article>

        <!-- PROJECT 3 (Video Left) -->
        <article class="bg-transparent border border-cyber-blue/30 p-1 md:p-6 relative group">
            <div class="absolute top-0 left-0 w-full h-[1px] bg-cyber-blue/30"></div>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <div class="space-y-4">
                    <div id="p3-viewer" class="aspect-video bg-black border border-cyber-blue/50 relative overflow-hidden flex items-center justify-center">
                        <video class="w-full h-full object-contain" autoplay loop muted playsinline><source src="ball.mp4" type="video/mp4"></video>
                    </div>
                    <div class="flex gap-3 overflow-x-auto pb-2">
                        <button onclick="switchMedia('p3', 'video', 'ball.mp4')" class="w-20 h-12 border border-cyber-blue/30 hover:border-cyber-blue thumb-active shrink-0 bg-gray-900 flex items-center justify-center"><span class="text-[10px] text-cyber-blue font-mono">VIDEO</span></button>
                        <button onclick="switchMedia('p3', 'image', 'ball1.PNG')" class="w-20 h-12 border border-cyber-blue/30 hover:border-cyber-blue shrink-0"><img src="ball1.PNG" class="w-full h-full object-cover opacity-70 hover:opacity-100"></button>
                        <button onclick="switchMedia('p3', 'image', 'ball2.PNG')" class="w-20 h-12 border border-cyber-blue/30 hover:border-cyber-blue shrink-0"><img src="ball2.PNG" class="w-full h-full object-cover opacity-70 hover:opacity-100"></button>
                    </div>
                </div>
                <div class="flex flex-col h-full font-mono">
                    <h2 class="text-3xl md:text-4xl text-white font-bold mb-2">Kinetic Core</h2>
                    <p class="text-gray-400 text-sm mb-6 border-l-2 border-cyber-blue/20 pl-4">Interactive AI particle interface using MediaPipe & WebGL.</p>
                </div>
            </div>
        </article>
    </section>

    <!-- Placeholders for About/Recruit -->
    <section id="about-section" class="hidden-section section-container text-center pt-24"><h1 class="text-4xl text-cyber-green font-mono">IDENTITY MATRIX LOADING...</h1></section>
    <section id="recruit-section" class="hidden-section section-container text-center pt-24"><h1 class="text-4xl text-cyber-pink font-mono">COMM CHANNELS OPENING...</h1></section>

    <!-- TERMINAL -->
    <div class="fixed bottom-0 left-0 w-full bg-cyber-black/95 border-t border-cyber-green/30 p-4 backdrop-blur-sm z-50">
        <div class="max-w-7xl mx-auto w-full">
            <div id="terminal-helper" class="text-cyber-blue mb-2 overflow-hidden h-0 transition-all duration-300 font-mono"></div>
            <div class="flex items-center text-sm md:text-xl text-cyber-green font-mono">
                <span class="mr-2 md:mr-3 font-bold"><span class="hidden md:inline">admin@deck:</span>~$</span>
                <input id="terminal-input" type="text" class="flex-1 bg-transparent border-none outline-none text-cyber-green placeholder-cyber-green/30 uppercase min-w-0" placeholder="ENTER COMMAND..." autocomplete="off">
            </div>
        </div>
    </div>

    <!-- MAIN JAVASCRIPT LOGIC -->
    <script>
        // --- 1. CONFIG & VARIABLES ---
        const logs = [ "INITIALIZING KERNEL...", "LOADING NEURAL INTERFACE...", "CHECKING SECURITY PROTOCOLS... OK", "ESTABLISHING CONNECTION...", "MOUNTING FILE SYSTEM...", "DECK ONLINE." ];
        let logIndex = 0;
        
        // DOM Elements
        const logContainer = document.getElementById('log-container');
        const bootScreen = document.getElementById('boot-screen');
        const startOverlay = document.getElementById('start-overlay');
        const music = document.getElementById('bg-music');
        const musicBtn = document.getElementById('music-btn');
        const input = document.getElementById('terminal-input');
        const helper = document.getElementById('terminal-helper');

        // --- AUDIO DEBUGGER ---
        // This will tell you if the MP3 file is missing
        if (music) {
            music.volume = 1.0; // Set to MAX volume to be sure
            music.addEventListener('error', function(e) {
                console.error("Audio Error:", e);
                alert("SYSTEM ERROR: 'factions.mp3' not found or format unsupported. Check file name and folder.");
            });
        }

        // --- 2. AUDIO SYSTEM ---
        function playSFX(id) {
            if (window.innerWidth < 768 && (id === 'sfx-hover' || id === 'sfx-type')) return;
            const audio = document.getElementById(id);
            if (audio) { audio.volume = 0.3; audio.currentTime = 0; audio.play().catch(e => {}); }
        }

        function toggleMusic(turnOn) {
            if (turnOn) {
                // Try to play
                const playPromise = music.play();
                
                if (playPromise !== undefined) {
                    playPromise.then(() => {
                        // Success
                        updateMusicBtnUI(true);
                    }).catch(error => {
                        // Failed (Browser policy or File missing)
                        console.error("Playback failed:", error);
                        updateMusicBtnUI(false);
                    });
                }
            } else {
                music.pause();
                updateMusicBtnUI(false);
            }
        }

        function updateMusicBtnUI(isOn) {
            if (isOn) {
                musicBtn.innerHTML = "[ MUSIC: <span class='animate-pulse'>ON</span> ]";
                musicBtn.classList.add('text-cyber-pink', 'border-cyber-pink');
                musicBtn.classList.remove('text-cyber-green', 'border-cyber-green');
            } else {
                musicBtn.innerHTML = "[ MUSIC: OFF ]";
                musicBtn.classList.add('text-cyber-green', 'border-cyber-green');
                musicBtn.classList.remove('text-cyber-pink', 'border-cyber-pink');
            }
        }

        // --- 3. BOOT SEQUENCE ---
        function runBootSequence() {
            if (logIndex < logs.length) {
                const div = document.createElement('div');
                div.className = "mb-2 border-l-2 border-cyber-green pl-2 animate-pulse";
                div.innerHTML = `<span class="opacity-50 mr-2">[${new Date().toLocaleTimeString()}]</span> ${logs[logIndex]}`;
                logContainer.appendChild(div);
                logIndex++;
                setTimeout(runBootSequence, 500);
            } else {
                sessionStorage.setItem('deck_booted', 'true');
                setTimeout(() => {
                    bootScreen.style.transition = "opacity 0.8s ease";
                    bootScreen.style.opacity = "0";
                    setTimeout(() => {
                        bootScreen.style.display = 'none';
                        navigateTo('home-section');
                    }, 800);
                }, 800);
            }
        }

        // --- 4. STARTUP LOGIC ---
        const isBooted = sessionStorage.getItem('deck_booted');

        if (isBooted === 'true') {
            if (startOverlay) startOverlay.style.display = 'none';
            if (bootScreen) bootScreen.style.display = 'none';
            navigateTo('home-section');
        } else {
            if (startOverlay) {
                startOverlay.addEventListener('click', () => {
                    sessionStorage.setItem('deck_booted', 'true');
                    startOverlay.style.transition = "opacity 0.5s ease";
                    startOverlay.style.opacity = '0';
                    setTimeout(() => startOverlay.remove(), 500);
                    
                    playSFX('sfx-boot');
                    
                    bootScreen.style.display = 'flex';
                    logIndex = 0;
                    logContainer.innerHTML = '';
                    runBootSequence();
                });
            }
        }

        // --- 5. NAVIGATION SYSTEM ---
        function navigateTo(sectionId) {
            playSFX('sfx-enter');
            document.querySelectorAll('.section-container').forEach(sec => {
                sec.classList.remove('active-section');
                sec.classList.add('hidden-section');
            });
            const target = document.getElementById(sectionId);
            if (target) {
                target.classList.remove('hidden-section');
                target.classList.add('active-section');
                window.scrollTo(0, 0);
                
                // *** ADD THIS: If going home, fix the gyro size ***
                if (sectionId === 'home-section' && window.resizeGyro) {
                    // Wait 50ms for the animation/display change to finish, then resize
                    setTimeout(window.resizeGyro, 50); 
                }
            }
        }

        // --- 6. MEDIA SWITCHER ---
        function switchMedia(projectId, type, source) {
            const viewer = document.getElementById(`${projectId}-viewer`);
            viewer.innerHTML = '';
            if (type === 'video') {
                const video = document.createElement('video');
                video.src = source;
                video.className = 'w-full h-full object-contain';
                video.controls = true; video.autoplay = true; video.muted = false;
                viewer.appendChild(video);
            } else {
                const img = document.createElement('img');
                img.src = source;
                img.className = 'w-full h-full object-contain animate-fade-in';
                img.style.animation = 'fadeIn 0.5s ease-out';
                viewer.appendChild(img);
            }
            const buttons = event.currentTarget.parentElement.querySelectorAll('button');
            buttons.forEach(btn => btn.classList.remove('thumb-active'));
            event.currentTarget.classList.add('thumb-active');
        }

        // --- 7. INPUT & COMMANDS ---
        if (musicBtn) {
            musicBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                if (music.paused) {
                    toggleMusic(true);
                } else {
                    toggleMusic(false);
                }
            });
        }

        document.addEventListener('click', (e) => {
            if (e.target.closest('button') || e.target.closest('a') || window.getSelection().toString().length > 0) return;
            input.focus();
        });

        input.addEventListener('keydown', (e) => {
            playSFX('sfx-type');
            if (e.key === 'Enter') {
                playSFX('sfx-enter');
                processCommand(input.value.trim().toUpperCase());
                input.value = '';
            }
        });

        function processCommand(cmd) {
            let msg = "";
            let action = null;
            switch(cmd) {
                case "WHOAMI": case "ABOUT": 
                    msg = "NAVIGATING TO IDENTITY MATRIX..."; action = () => navigateTo('about-section'); break;
                case "LS": case "PROJECTS": 
                    msg = "LISTING PROJECT DIRECTORIES..."; action = () => navigateTo('projects-section'); break;
                case "RECRUIT": case "CONTACT": 
                    msg = "OPENING COMM CHANNELS..."; action = () => navigateTo('recruit-section'); break;
                case "HOME": case "CD ..": 
                    msg = "RETURNING TO ROOT..."; action = () => navigateTo('home-section'); break;

                    // ... inside switch(cmd) ...

                case "GYRO REFRESH":
                case "RESET GYRO":
                    msg = "RESTORING DEFAULT CONFIGURATION...";
                    action = () => {
                        if (window.gyroAPI) window.gyroAPI.reset();
                    };
                    break;
                
                /// --- GYRO COMMANDS (UPDATED) ---
                case "ZOOM":
                case "ZOOM IN":
                case "ENHANCE":
                    msg = "ENHANCING OPTICAL SENSORS...";
                    action = () => {
                        // We check if it's already zoomed in? 
                        // The toggle function handles both, but let's just trigger it.
                        if (window.gyroAPI) window.gyroAPI.toggleZoom();
                    };
                    break;
                case "ZOOM OUT":
                    msg = "RESETTING OPTICAL SENSORS...";
                    action = () => {
                        if (window.gyroAPI) window.gyroAPI.toggleZoom();
                    };
                    break;
                case "SCAN":
                    msg = "PERFORMING STRUCTURAL SCAN...";
                    action = () => {
                        if (window.gyroAPI) window.gyroAPI.scan();
                    };
                    break;
                case "MODE RED":
                    msg = "SWITCHING HUD TO: TACTICAL RED";
                    action = () => { if (window.gyroAPI) window.gyroAPI.setColor(0xff0000); };
                    break;
                case "MODE BLUE":
                    msg = "SWITCHING HUD TO: OCEANIC BLUE";
                    action = () => { if (window.gyroAPI) window.gyroAPI.setColor(0x00f0ff); };
                    break;
                
                // Update HELP
                case "HELP":
                case "CMDS": // Added shortcut
                    // Broken into lines for better readability in the terminal
                    msg = `AVAILABLE COMMANDS: <br>
                           > NAVIGATION: HOME, PROJECTS, ABOUT, RECRUIT <br>
                           > GYRO: ZOOM, SCAN, GYRO REFRESH, MODE [RED/BLUE] <br>
                           > SYSTEM: MUSIC ON/OFF, REBOOT, CLEAR`;
                    break;
                
                // Update HELP to show new commands
                case "HELP": 
                    msg = "COMMANDS: HOME, PROJECTS, BOOST, SCAN, MODE [RED/BLUE], MUSIC ON/OFF"; break;    


                // MUSIC COMMANDS
                case "MUSIC ON":
                    msg = "AUDIO STREAM ESTABLISHED.";
                    action = () => toggleMusic(true);
                    break;
                case "MUSIC OFF":
                    msg = "AUDIO STREAM DISCONNECTED.";
                    action = () => toggleMusic(false);
                    break;

                case "REBOOT": 
                    sessionStorage.removeItem('deck_booted'); action = () => window.location.reload(); break;
                case "HELP": 
                    msg = "COMMANDS: HOME, LS, WHOAMI, RECRUIT, MUSIC ON/OFF, REBOOT"; break;
                default: 
                    msg = `COMMAND '${cmd}' NOT RECOGNIZED.`;
            }
            if (msg) { helper.innerHTML = `>> ${msg}`; helper.style.height = "auto"; }
            if (action) action();
        }

        document.querySelectorAll('button').forEach(btn => btn.addEventListener('mouseenter', () => playSFX('sfx-hover')));

        const style = document.createElement('style');
        style.innerHTML = `@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }`;
        document.head.appendChild(style);

        // ==========================================
    // MINI-MAP GYRO SYSTEM v7.0 (DEEP DATA CORE)
    // ==========================================
    function initGyroSystem() {
        const container = document.getElementById('mini-map-container');
        if (!container) return;

        // 1. Setup Scene
        const scene = new THREE.Scene();
        
        const camera = new THREE.PerspectiveCamera(50, container.clientWidth / container.clientHeight, 0.1, 100);
        camera.position.z = 8; // Start Zoomed Out

        const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
        renderer.setSize(container.clientWidth, container.clientHeight);
        renderer.setPixelRatio(window.devicePixelRatio);
        container.appendChild(renderer.domElement);

        // 2. The Outer Shell (Wireframe Globe)
        const geometry = new THREE.IcosahedronGeometry(2.2, 2); 
        const material = new THREE.MeshBasicMaterial({ 
            color: 0xff00ff, 
            wireframe: true, 
            transparent: true, 
            opacity: 0.4 // Base opacity
        });
        const globe = new THREE.Mesh(geometry, material);
        scene.add(globe);

        // 3. The Inner Core (Data Particles) - HIDDEN AT START
        const particleGeo = new THREE.BufferGeometry();
        const particleCount = 1500;
        const posArray = new Float32Array(particleCount * 3);
        
        for(let i = 0; i < particleCount * 3; i++) {
            // Random points inside a smaller sphere (radius 1.8)
            posArray[i] = (Math.random() - 0.5) * 3.6;
        }
        
        particleGeo.setAttribute('position', new THREE.BufferAttribute(posArray, 3));
        
        const particleMat = new THREE.PointsMaterial({
            size: 0.03,
            color: 0x00f0ff, // Cyan Core
            transparent: true,
            opacity: 0.0, // Start Invisible
            blending: THREE.AdditiveBlending
        });
        
        const core = new THREE.Points(particleGeo, particleMat);
        scene.add(core);

        // 4. Orbital Ring (Decoration)
        const ringGeo = new THREE.TorusGeometry(3.5, 0.02, 16, 100);
        const ringMat = new THREE.MeshBasicMaterial({ color: 0x00f0ff, transparent: true, opacity: 0.2 });
        const ring = new THREE.Mesh(ringGeo, ringMat);
        ring.rotation.x = Math.PI / 2;
        scene.add(ring);

        // 5. Variables
        let isZoomed = false;
        let targetZ = 8;       // Camera Distance
        let targetOpacity = 0.0; // Core Opacity
        let targetWireOpacity = 0.4;
        
        // SLOWER ROTATION SETTINGS
        let mouseX = 0, mouseY = 0;
        let autoRotateX = 0.001; // Very slow idle spin
        let autoRotateY = 0.002;

        const uiX = document.getElementById('gyro-x');
        const uiY = document.getElementById('gyro-y');
        let currentBaseColor = 0xff00ff; 

        // 4. API & Interaction
        window.gyroAPI = {
            toggleZoom: () => {
                isZoomed = !isZoomed;
                playSFX('sfx-enter');

                if (isZoomed) {
                    targetZ = 2.5;         
                    targetOpacity = 0.8;   
                    targetWireOpacity = 0.1; 
                } else {
                    targetZ = 8;
                    targetOpacity = 0.0;   
                    targetWireOpacity = 0.4;
                }
            },
            setColor: (hex) => {
                currentBaseColor = hex;
                material.color.setHex(hex);
                core.material.color.setHex(hex);
            },
            // --- NEW: RESET FUNCTION ---
            reset: () => {
                // Reset Color to Default Pink
                const defaultPink = 0xff00ff;
                currentBaseColor = defaultPink;
                material.color.setHex(defaultPink);
                core.material.color.setHex(defaultPink);
                
                // Reset Zoom if needed (Optional, but "Original Form" implies unzoomed)
                if (isZoomed) {
                     isZoomed = false;
                     targetZ = 8;
                     targetOpacity = 0.0;
                     targetWireOpacity = 0.4;
                }
            },
            scan: () => {
                const originalScale = ring.scale.x;
                ring.scale.setScalar(0.1);
                let growInterval = setInterval(() => {
                    ring.scale.addScalar(0.1);
                    if(ring.scale.x >= originalScale) {
                        ring.scale.setScalar(originalScale);
                        clearInterval(growInterval);
                    }
                }, 20);
            }
        };

        // Inputs
        document.addEventListener('mousemove', (e) => {
            if (!container || container.offsetParent === null) return;
            const rect = container.getBoundingClientRect();
            if (rect.width === 0) return;
            mouseX = ((e.clientX - rect.left) / rect.width) * 2 - 1;
            mouseY = -((e.clientY - rect.top) / rect.height) * 2 + 1;
        });

        // CLICK TO TOGGLE ZOOM
        container.addEventListener('mousedown', () => window.gyroAPI.toggleZoom());

        // 7. Animation Loop
        const animate = () => {
            requestAnimationFrame(animate);
            if (container.offsetParent === null) return;

            // --- SMOOTH CAMERA MOVE (ZOOM) ---
            camera.position.z = THREE.MathUtils.lerp(camera.position.z, targetZ, 0.05);
            
            // --- FADE EFFECTS ---
            // Fade Core In/Out
            core.material.opacity = THREE.MathUtils.lerp(core.material.opacity, targetOpacity, 0.05);
            // Fade Shell Out/In
            globe.material.opacity = THREE.MathUtils.lerp(globe.material.opacity, targetWireOpacity, 0.05);

            // --- ROTATION (Controlled by Mouse + Slow Idle) ---
            // Reduced mouse sensitivity (0.05 -> 0.02)
            globe.rotation.y += autoRotateY + (mouseX * 0.02);
            globe.rotation.x += autoRotateX - (mouseY * 0.02);
            
            // Core rotates slightly faster for depth effect
            core.rotation.y = globe.rotation.y * 1.2;
            core.rotation.x = globe.rotation.x * 1.2;

            // Ring Tumble
            ring.rotation.x += 0.002;
            ring.rotation.y += 0.002;

            // Update UI
            if (uiX) uiX.innerText = (globe.rotation.x % 6.28).toFixed(2);
            if (uiY) uiY.innerText = (globe.rotation.y % 6.28).toFixed(2);

            renderer.render(scene, camera);
        };
        animate();

        window.resizeGyro = () => {
            if(!container) return;
            const width = container.clientWidth || 100;
            const height = container.clientHeight || 100;
            camera.aspect = width / height;
            camera.updateProjectionMatrix();
            renderer.setSize(width, height);
        };
        window.addEventListener('resize', window.resizeGyro);
    }

    window.addEventListener('load', initGyroSystem);
    </script>
</body>
</html>